"use strict";const CACHE_NAME="szcache",RESOURCES=[["index.html","update.js"],["manifest.json","favicon.png","icon.png"]];var lastCheckUpdateTime=0;function getResKey(u){var f=(f=registration.scope)||location.origin,u=u.url.substring(f.length);return u=""==(u="/"==u.substring(0,1)?u.substring(1):u)||"/"==u||u.startsWith("#")||u.startsWith("?v=")||u.startsWith("?_=")?"index.html":u}async function reloadAll(){return caches.open(CACHE_NAME).then(E=>{E.keys().then(function(u){u.forEach(function(u,f,d){if(u){var p=u.url.split("/").pop();-1===RESOURCES[1].indexOf(p)&&E.delete(u)}})});var d=registration.scope;RESOURCES[0].forEach(f=>{fetch(d+f).then(u=>{E.put(d+f,u.clone());"index.html"==f&&E.put(d,u.clone())})})}).catch(u=>{caches.delete(CACHE_NAME)})}async function checkUpdate(){try{var u=registration.scope+"update.js",f=await fetch(u,{cache:"reload"}),d=await f.text();if(!d||!d.match(/^\d+$/))return;var p=await caches.open(CACHE_NAME);if(!(f=await p.match(u)))return p.put(u,new Response(d)),void 0;var E=await f.text();E!=d&&reloadAll()}catch(u){}}self.addEventListener("fetch",u=>{if("GET"===u.request.method){var f=getResKey(u.request);if(-1!==RESOURCES[1].indexOf(f))return cacheOnly(u);if(-1!==RESOURCES[0].indexOf(f)){if("index.html"==f){f=+new Date;if(36e5<f-lastCheckUpdateTime){lastCheckUpdateTime=f;checkUpdate()}}return cacheFirst(u)}}});self.addEventListener("message",u=>{"skipWaiting"===u.data&&self.skipWaiting()});self.addEventListener("install",u=>u.waitUntil(self.skipWaiting()));self.addEventListener("activate",function(u){return u.waitUntil(async function(){await reloadAll();await self.clients.claim()}())});function cacheOnly(f){return f.respondWith(caches.open(CACHE_NAME).then(u=>u.match(f.request)))}function cacheFirst(d){return d.respondWith(caches.open(CACHE_NAME).then(f=>f.match(d.request).then(u=>u||fetch(d.request).then(u=>{f.put(d.request,u.clone());return u}))))}